# 0xLeaks

Простой веб-сайт для публикации статей с системой комментариев.

## Настройка базы данных

Для работы с сайтом необходимо настроить базу данных в Supabase.

### Исправление ошибки "relation already exists"

Если вы видите ошибку `ERROR: 42P07: relation "posts" already exists`, это означает, что таблица уже существует в базе данных. В этом случае вам нужно выполнить только скрипт для создания таблицы комментариев.

### Создание таблицы комментариев

1. Откройте SQL-редактор в панели управления Supabase
2. Выполните следующий SQL-скрипт для создания таблицы комментариев:

```sql
-- Проверяем существование таблицы comments перед созданием
DO $$
BEGIN
    IF NOT EXISTS (SELECT FROM pg_tables WHERE schemaname = 'public' AND tablename = 'comments') THEN
        -- Создание таблицы для хранения комментариев
        CREATE TABLE public.comments (
          id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
          post_id uuid NOT NULL REFERENCES public.posts(id) ON DELETE CASCADE,
          author_name text NOT NULL,
          content text NOT NULL,
          created_at timestamp with time zone DEFAULT now()
        );

        -- Настройка RLS для комментариев
        ALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;

        -- Политики безопасности для комментариев
        CREATE POLICY "Публичный доступ на чтение комментариев"
          ON public.comments FOR SELECT
          USING (true);

        CREATE POLICY "Анонимный доступ на вставку комментариев"
          ON public.comments FOR INSERT
          TO anon
          WITH CHECK (true);

        -- Индекс для ускорения выборки комментариев по посту
        CREATE INDEX comments_post_id_idx ON public.comments (post_id);
        CREATE INDEX comments_created_at_idx ON public.comments (created_at DESC);

        -- Комментарий к таблице
        COMMENT ON TABLE public.comments IS 'Таблица для хранения комментариев к постам';
        
        RAISE NOTICE 'Таблица comments успешно создана';
    ELSE
        RAISE NOTICE 'Таблица comments уже существует';
    END IF;
END
$$;
```

3. Нажмите кнопку "Run" для выполнения скрипта
4. Обновите страницу сайта

## Функциональность

### Публикации
- Просмотр списка публикаций
- Просмотр отдельной публикации
- Создание, редактирование и удаление публикаций (для администратора)

### Комментарии
- Просмотр комментариев к публикации
- Добавление комментариев (с ограничением в один комментарий каждые 5 минут)
- Имя пользователя сохраняется в cookies и используется для всех комментариев

## Доступ администратора

Для доступа к панели администратора используйте пароль: `leo563903W`

## Особенности

- Темный, современный дизайн
- Полностью адаптивный интерфейс для мобильных устройств
- Защищенная паролем админ-панель
- Богатый текстовый редактор для создания постов
- Интеграция с Supabase для хранения данных
- Плавные анимации и переходы
- Защита от копирования контента и масштабирования страницы
- Progressive Web App (PWA) с возможностью установки на устройство
- Работа в офлайн-режиме с доступом к кэшированному контенту

## Настройка Supabase

1. Создайте новый проект в [Supabase](https://supabase.com/)
2. В SQL редакторе выполните скрипт из файла `sql_setup.sql`
3. Скопируйте URL и API ключ из настроек проекта и обновите соответствующие константы в `script.js`

## Установка и запуск

1. Клонируйте репозиторий:
```
git clone https://github.com/ваш-пользователь/ваш-репозиторий.git
```

2. Откройте `index.html` в браузере или разместите файлы на веб-сервере.

3. Для локальной разработки можно использовать простой HTTP-сервер:
```
npx serve
```

## Публикация на GitHub Pages

1. Создайте новый репозиторий на GitHub
2. Загрузите все файлы проекта в репозиторий
3. В настройках репозитория включите GitHub Pages и выберите ветку `main` или `master`
4. Ваш сайт будет доступен по адресу `https://ваш-пользователь.github.io/ваш-репозиторий/`

## Структура проекта

- `index.html` - основная HTML-страница
- `style.css` - стили для сайта
- `script.js` - JavaScript-код для функциональности сайта
- `sql_setup.sql` - SQL-скрипт для настройки базы данных Supabase
- `manifest.json` - файл манифеста для PWA
- `service-worker.js` - Service Worker для кэширования и офлайн-функциональности
- `offline.html` - страница, отображаемая при отсутствии интернет-соединения
- `icons/` - директория с иконками для PWA

## Progressive Web App (PWA)

Сайт реализован как Progressive Web App, что позволяет:

1. **Установить сайт как приложение** на устройство пользователя (мобильные устройства, десктоп)
2. **Работать офлайн** с доступом к ранее просмотренному контенту
3. **Получать push-уведомления** (при наличии соответствующего серверного API)
4. **Быстрая загрузка** за счет кэширования ресурсов

### Установка PWA

1. Откройте сайт в браузере, поддерживающем PWA (Chrome, Edge, Firefox, Safari)
2. В адресной строке или меню браузера появится значок установки
3. Нажмите на значок и следуйте инструкциям для установки
4. Приложение будет добавлено на главный экран устройства или в меню приложений

### Генерация иконок

Для создания иконок PWA используйте файл `icons/create_icons.html`:

1. Откройте файл в браузере
2. Нажмите кнопку "Создать иконки"
3. Сохраните сгенерированные иконки в папку `icons/` с соответствующими именами

Для продакшн рекомендуется заменить сгенерированные иконки на профессионально разработанные.

## Безопасность

- Пароль для доступа к админ-панели захардкожен в JavaScript-файле
- В реальном проекте рекомендуется использовать более безопасные методы аутентификации
- Для дополнительной безопасности настройте правила доступа в Supabase

## Лицензия

MIT 